!function(t){function e(e){for(var n,s,i=e[0],l=e[1],h=e[2],d=0,u=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&u.push(r[s][0]),r[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);for(c&&c(e);u.length;)u.shift()();return o.push.apply(o,h||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,i=1;i<a.length;i++){var l=a[i];0!==r[l]&&(n=!1)}n&&(o.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},r={0:0},o=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var h=0;h<i.length;h++)e(i[h]);var c=l;o.push([13,1]),a()}({1:function(t,e,a){var n=a(10),r=a(11);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var o={insert:"head",singleton:!1};n(r,o);t.exports=r.locals||{}},11:function(t,e,a){(e=a(12)(!1)).push([t.i,".src-demo-MagicWand__wrapper--1CVBL {\r\n    top: 80px;\r\n    width: 100vw;\r\n    height: 100vh;\r\n    overflow:auto;    \r\n}\r\n.src-demo-MagicWand__content--m8ph- {\r\n    position: relative;\r\n}\r\n.src-demo-MagicWand__canvas--3do8M {\r\n    position: absolute;\r\n}\r\n.src-demo-MagicWand__canvas--3do8M:hover {\r\n    cursor: default;\r\n}\r\n.src-demo-MagicWand__picture--1DUrw {\r\n    position: absolute;\r\n}\r\n.src-demo-MagicWand__button--1UN9z {\r\n    padding: 4px;\r\n    margin: 4px;\r\n    border: 1px solid black;\r\n    float: left;\r\n}\r\n.src-demo-MagicWand__button--1UN9z:hover {\r\n    background-color: blue;\r\n    color: white;\r\n    cursor: pointer\r\n}\r\n#src-demo-MagicWand__threshold--N0uOH {\r\n    width: 95px;\r\n    float: left;\r\n}\r\n#src-demo-MagicWand__file-upload--2bH4j {\r\n    display: none;\r\n}",""]),e.locals={wrapper:"src-demo-MagicWand__wrapper--1CVBL",content:"src-demo-MagicWand__content--m8ph-",canvas:"src-demo-MagicWand__canvas--3do8M",picture:"src-demo-MagicWand__picture--1DUrw",button:"src-demo-MagicWand__button--1UN9z",threshold:"src-demo-MagicWand__threshold--N0uOH","file-upload":"src-demo-MagicWand__file-upload--2bH4j"},t.exports=e},13:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),o=a(4),s=a.n(o),i=a(2),l=a.n(i),h=a(5),c=a.n(h),d=a(1),u=a.n(d);class g extends r.a.Component{constructor(){super();this.state={colorThreshold:15,blurRadius:5,simplifyTolerant:0,simplifyCount:30,hatchLength:4,hatchOffset:0,imageInfo:null,cacheInd:null,mask:null,downPoint:null,allowDraw:!1,currentThreshold:15}}uploadClick(){document.getElementById("file-upload").click()}onRadiusChange(t){blurRadius=t.target.value}imgChange(t){const e=t.target;if(e.files&&e.files[0]){var a=new FileReader;let t=this;a.onload=function(e){var a=document.getElementById("test-picture");a.setAttribute("src",e.target.result),a.onload=function(){t.initCanvas(a)}},a.readAsDataURL(e.files[0])}}initCanvas(t){var e=document.getElementById("resultCanvas");e.width=t.width,e.height=t.height,this.setState({imageInfo:{width:t.width,height:t.height,context:e.getContext("2d")}}),this.setState({mask:null});var a=document.createElement("canvas").getContext("2d");let n=this.state.imageInfo;a.canvas.width=n.width,a.canvas.height=n.height,a.drawImage(t,0,0),n.data=a.getImageData(0,0,n.width,n.height),this.setState({imageInfo:n})}getMousePosition(t){var e=c()(t.target).offset();return{x:Math.round((t.clientX||t.pageX)-e.left),y:Math.round((t.clientY||t.pageY)-e.top)}}onMouseDown(t){if(0==t.button){this.setState({allowDraw:!0});let e=this.getMousePosition(t);this.setState({downPoint:e}),this.drawMask(e.x,e.y)}else this.setState({allowDraw:!1})}onMouseMove(t){if(this.state.allowDraw){var e=this.getMousePosition(t);let h=this.state.downPoint;if(e.x!=h.x||e.y!=h.y){var a=e.x-h.x,n=e.y-h.y,r=Math.sqrt(a*a+n*n),o=Math.abs(a),s=Math.abs(n),i=o>s?a/o:n/s;i=i<0?i/5:i/3;var l=Math.min(Math.max(this.state.colorThreshold+Math.floor(i*r),1),255);l!=this.state.currentThreshold&&(this.setState({currentThreshold:l}),this.drawMask(h.x,h.y))}}}onMouseUp(t){this.setState({allowDraw:!1}),this.setState({currentThreshold:this.state.colorThreshold})}showThreshold(){document.getElementById("threshold").innerHTML="Threshold: "+this.state.currentThreshold}drawMask(t,e){let a=this.state.imageInfo;if(!a)return;this.showThreshold();var n={data:a.data.data,width:a.width,height:a.height,bytes:4};let r=l.a.floodFill(n,t,e,this.state.currentThreshold,null,!0);r=l.a.gaussBlurOnlyBorder(r,blurRadius),this.setState({mask:r}),this.drawBorder()}hatchTick(){let t=this.state.hatchOffset,e=this.state.hatchLength;this.setState({hatchOffset:(t+1)%(2*e)}),this.drawBorder(!0)}drawBorder(t){let e=this.state.mask,a=this.state.imageInfo;if(!e)return;var n,r,o,s,i,h=a.width,c=a.height,d=a.context,u=d.createImageData(h,c),g=u.data;let m;t||(m=l.a.getBorderIndices(e)),d.clearRect(0,0,h,c);var f=m.length;for(s=0;s<f;s++)i=4*((r=((o=m[s])-(n=o%h))/h)*h+n),(n+r+this.state.hatchOffset)%(2*this.state.hatchLength)<this.state.hatchLength||(g[i]=255,g[i+1]=255,g[i+2]=255),g[i+3]=255;d.putImageData(u,0,0)}trace(){var t=l.a.traceContours(this.state.mask);t=l.a.simplifyContours(t,this.state.simplifyTolerant,this.state.simplifyCount),this.setState({mask:null});let e=this.state.imageInfo;var a=e.context;a.clearRect(0,0,e.width,e.height),a.beginPath();for(var n=0;n<t.length;n++)if(t[n].inner){var r=t[n].points;a.moveTo(r[0].x,r[0].y);for(var o=1;o<r.length;o++)a.lineTo(r[o].x,r[o].y)}a.strokeStyle="red",a.stroke(),a.beginPath();for(n=0;n<t.length;n++)if(!t[n].inner){r=t[n].points;a.moveTo(r[0].x,r[0].y);for(o=1;o<r.length;o++)a.lineTo(r[o].x,r[o].y)}a.strokeStyle="blue",a.stroke()}paint(t,e){const a=this.state.mask,n=this.state.imageInfo;if(a){var r,o,s=this.hexToRgb(t,e),i=a.data,l=a.bounds,h=a.width,c=n.width,d=n.height,u=n.context,g=u.createImageData(c,d),m=g.data;for(o=l.minY;o<=l.maxY;o++)for(r=l.minX;r<=l.maxX;r++){if(0==i[o*h+r])continue;let t=4*(o*c+r);m[t]=s[0],m[t+1]=s[1],m[t+2]=s[2],m[t+3]=s[3]}this.setState({mask:null}),u.putImageData(g,0,0)}}hexToRgb(t,e){var a=parseInt(t,16);return[a>>16&255,a>>8&255,255&a,Math.round(255*e)]}componentDidMount(){this.showThreshold()}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{overflow:"auto"}},r.a.createElement("div",{className:u.a.button,onClick:this.uploadClick},"Upload image and click on it"),r.a.createElement("div",{className:u.a.button,onClick:this.trace.bind(this)},"Create polygons by current selection"),r.a.createElement("div",{className:u.a.button,onClick:()=>this.paint("FF0000",.35)},"Paint the selection"),r.a.createElement("input",{id:"file-upload",type:"file",accept:"image/*",onChange:this.imgChange.bind(this)})),r.a.createElement("div",{style:{overflow:"auto"}},r.a.createElement("div",{style:{float:"left",marginRight:"10px"}},"Blur radius: "),r.a.createElement("input",{id:"blurRadius",value:this.state.blurRadius,type:"text",onChange:this.onRadiusChange,style:{float:"left",width:"20px",marginRight:"10px"}}),r.a.createElement("div",{id:"threshold"})),r.a.createElement("div",null,"(hold left mouse button and move to change the color threshold)"),r.a.createElement("div",{className:u.a.wrapper},r.a.createElement("div",{className:u.a.content},r.a.createElement("img",{id:"test-picture",className:u.a.picture}),r.a.createElement("canvas",{className:u.a.canvas,id:"resultCanvas",onMouseUp:this.onMouseUp.bind(this),onMouseDown:this.onMouseDown.bind(this),onMouseMove:this.onMouseMove.bind(this)}))))}}var m=g;const f=()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(m,null));s.a.render(r.a.createElement(f,null),document.querySelector("#root"))}});